# GEMINI.md — Agent 실수 기록 및 행동 지침

> 이 파일은 AI 에이전트가 작업 중 저지른 실수를 누적 기록하고,
> 다음 작업에서 동일한 실수를 반복하지 않도록 안내하는 문서입니다.
> **모든 새 작업 시작 전에 반드시 이 파일을 읽고 숙지하세요.**

---

## 📌 필수 행동 원칙 (항상 준수)

- 작업 전 이 파일 전체를 읽고 과거 실수를 확인한다.
- 확신이 없는 명령어나 작업은 실행 전에 사용자에게 확인을 구한다.
- 파일 삭제, 덮어쓰기, 권한 변경 등 되돌리기 어려운 작업은 반드시 사전 고지한다.
- 작업 완료 후 실수가 있었다면 이 파일에 즉시 기록한다.

---

## 🗂️ 실수 기록

> 형식: 날짜 | 심각도 | 카테고리 | 요약
> 심각도: 🔴 Critical / 🟠 High / 🟡 Medium / 🟢 Low

---

### [YYYY-MM-DD] 실수 제목을 간결하게 작성

- **심각도**: 🟡 Medium
- **카테고리**: `파일 조작` / `명령어 오류` / `경로 실수` / `의존성` / `기타`
- **작업 컨텍스트**: 어떤 작업을 하던 중이었는지 한 줄 설명
- **실수 내용**: 무엇을 잘못했는지 구체적으로 서술
- **원인 분석**: 왜 이 실수가 발생했는지
- **실제 결과**: 이 실수로 인해 어떤 일이 발생했는지
- **올바른 방법**: 앞으로 이 상황에서 어떻게 행동해야 하는지
- **재발 방지 규칙**: `[ ] 실행 전 ~~을 확인한다`

---

<!-- 아래에 실수 기록을 계속 추가하세요 -->

### [2026-02-28] CreditStore 탭 전환 커스텀 네비게이션 결함으로 빈 화면 발생

- **심각도**: 🟠 High
- **카테고리**: 기타
- **작업 컨텍스트**: `MainActivity`의 CreditStore 전용 BottomNavigation 분기와 Billing 콜백 안정화 작업
- **실수 내용**: CreditStore에서 탭 이동 시 `popBackStack(R.id.creditStoreFragment, true)` 이후 `navigate()` 실패 케이스를 복구하지 않고 `false` 반환하도록 설계해, 특정 흐름에서 컨테이너가 비는 상태를 만들었다. 동시에 Billing 콜백의 메인 스레드 보장을 누락해 UI 갱신(`notifyAdapterChanged`)이 백그라운드에서 호출될 여지를 남겼다.
- **원인 분석**:
  1. `pop + navigate`를 원자적으로 항상 성공한다고 가정함.
  2. 외부 SDK 콜백 스레드 컨텍스트를 명시적으로 통제하지 않음.
- **실제 결과**: 사용자 환경에서 “아예 아무 Fragment도 보이지 않음” 증상이 재현되었고, 반복 피드백과 추가 수정이 필요했다.
- **올바른 방법**: `popBackStack` 이후 `navigate` 실패를 기본 실패 시나리오로 가정하고 start destination 복구 fallback을 넣어야 한다. Billing/SDK 콜백은 `Handler(Looper.getMainLooper())`로 UI 호출을 강제해야 한다.
- **재발 방지 규칙**: `[ ] 커스텀 탭 네비게이션 변경 시 popBackStack 이후 navigate 실패 복구(fallback)와 UI 메인 스레드 디스패치를 릴리즈 전 반드시 검증한다.`

### [2026-02-28] 명세 해석 오류 및 뷰 중첩(Overlap) 문제

- **심각도**: 🟡 Medium
- **카테고리**: 기타
- **작업 컨텍스트**: `LoginActivity.java`에 `DialogueLearningFragment`의 BottomSheet 애니메이션 적용 (가입/로그인 단계 전환)
- **실수 내용**: 사용자가 의도한 "단계 간 전환 시 BottomSheet가 아래로 완전히 접혔다가 새 뷰로 교체 후 다시 펼쳐지는 애니메이션"을 파악하지 못하고, 오직 화면 첫 진입 시 바텀시트가 통째로 튀어오르는 초기 진입 애니메이션에만 집중하여 수정함. 또한 뷰 전환 로직을 수정할 때 기존 로딩 레이아웃(`layout_login_loading`)과 나머지 컨텐츠 뷰들 간 명시적인 `GONE` 처리를 누락하여 화면 중첩 현상이 일어남.
- **원인 분석**: 
  1. "바텀시트 전환 애니메이션"이라는 요구사항에서 "어떤 맥락의 전환인지(초기 진입 vs 단계 이동)" 명확히 파악하지 않고 한 가지 형태(Spring)로 섣불리 단정지음.
  2. 여러 단계를 `FrameLayout` 안에서 `visibility`로만 조작하는 구조(`swapViews`)에서 예외 상태인 "로딩(`loading`)" 단계의 특수성을 고려하지 않아 `GONE` 처리에 누락된 View가 생김.
- **실제 결과**: 사용자가 의도와 다르다고 재차 피드백하며 여러 차례 코드를 롤백하고 덧댐 수정해야 했고, 로딩 화면 진입 시 로그인 폼과 겹쳐 보이는 UI 버그가 노출됨.
- **올바른 방법**: UI 애니메이션이나 로직 수정 시, "어느 시점(Trigger)"에 일어나는 일인지 기존 레퍼런스를 면밀히 돌려보거나 사용자의 의도를 먼저 명확하게 다져야 함. 또한 `visibility` 기반의 뷰 스와핑을 구현할 때는 연관된 모든 형제 뷰들에 대한 명시적인 보임/숨김 처리가 꼼꼼히 이뤄지도록 Cross-check 해야 함.
- **재발 방지 규칙**: `[ ] 동일 레이아웃 컨테이너 내에서 뷰 교체(View Swapping)를 구현/수정할 때는 관련된 모든 형제 뷰(sibling views)가 명시적으로 GONE 처리되는지 재확인한다.`


### [2026-02-27] multi_replace_file_content 사용 시 기존 import 구문 누락

- **심각도**: 🟡 Medium
- **카테고리**: 파일 조작
- **작업 컨텍스트**: `LoginActivity.java`에 `FirebaseFirestore` import를 추가하기 위해 `multi_replace_file_content` 툴을 사용하던 중
- **실수 내용**: TargetContent의 첫 줄이었던 `import com.google.firebase.auth.FirebaseAuth;`를 ReplacementContent에서 실수로 누락시켜 의도치 않게 삭제해버림.
- **원인 분석**: 툴의 ReplacementChunk를 작성할 때, TargetContent에 명시된 원래의 코드 조각 중 유지해야 할 부분을 ReplacementContent에도 온전히 포함시키는 크로스체크가 미흡했음.
- **실제 결과**: `FirebaseAuth` 심볼을 찾을 수 없다는 컴파일 에러가 발생하여 안드로이드 빌드(`assembleDebug`)가 실패했고, 추가적인 수정 작업이 필요했음.
- **올바른 방법**: `multi_replace_file_content` 또는 `replace_file_content` 툴을 사용할 때는 반드시 TargetContent에 포함된 기존 코드 중 보존되어야 할 라인들이 ReplacementContent에 빠짐없이 포함되어 있는지 다시 한번 확인해야 함.
- **재발 방지 규칙**: `[ ] multi_replace_file_content 사용 시 유지해야 할 기존 코드가 번역/교체 컨텐츠에 제대로 포함되었는지 반드시 대조/확인한다.`

### [2026-02-27] 다이얼로그 레이아웃 추가 시 연관 Drawable/Color 리소스 누락

- **심각도**: 🟡 Medium
- **카테고리**: 기타
- **작업 컨텍스트**: 설정 화면 내 비밀번호 변경 기능을 위한 `dialog_change_password.xml` 레이아웃 파일 생성
- **실수 내용**: 다이얼로그 레이아웃에서 참조하는 배경 Drawable(bg_edittext 등) 및 컬러 리소스(color_hint_text 등)를 함께 추가하지 않고 xml 레이아웃만 단독으로 작성함.
- **원인 분석**: UI 요소 작성에 집중하여, 파일 내에서 참조하고 있는 @drawable, @color 속성이 프로젝트 내에 이미 존재하는지 크로스체크가 누락됨.
- **실제 결과**: `Android resource linking failed` 에러가 다수 발생해 앱 빌드가 실패했고, 추가 작업(수정)이 필요했음.
- **올바른 방법**: 새로운 layout XML을 작성/수정할 때는, 해당 파일에서 처음으로 도입하는 혹은 누락 가능성이 있는 리소스 식별자를 미리 확인하고 동시에 생성해야 함.
- **재발 방지 규칙**: `[ ] 레이아웃 XML 파일 생성/수정 시 참조하는 모든 리소스(drawable, color, string)가 함께 생성되었거나 이미 존재하는지 점검한다.`

### [2026-02-27] 파일 내 존재하는 특정 뷰 요소와 메서드 참조 실수

- **심각도**: 🟡 Medium
- **카테고리**: 파일 조작
- **작업 컨텍스트**: `SettingFragment.java`의 보상형 광고 대기 `AlertDialog`를 `dialog_charge_credit.xml` 커스텀 뷰 내부 로딩으로 전환하는 작업
- **실수 내용**: 커스텀 다이얼로그 뷰(`chargeCreditDialog`)를 적용하면서, `chargeCreditDialog`에 대응하는 `dismissLoadingAdDialog()` 등 구버전 메서드 및 변수 호출들을 깔끔하게 삭제하고 교체하지 않아 불필요한 메서드 정의가 남거나 적용이 실패함. (결과 오류: target content not found in file 발생)
- **원인 분석**: `multi_replace_file_content` 툴을 사용할 때, 기존 `showLoadingAdDialog()`, `dismissLoadingAdDialog()` 등을 통째로 삭제해야 했는데, 참조되는 곳(예: `onAdLoaded` 등)의 코드를 한 번에 정확히 매핑하여 삭제/수정하지 못함
- **실제 결과**: `multi_replace_file_content`의 replacement가 일치하지 않아 부분 실패가 났고 여러 차례 덧댐 수정을 거쳐야 했음.
- **올바른 방법**: 이전 로직을 완전히 덜어내는 방향으로 아키텍처를 변경할 경우(e.g., AlertDialog -> Custom View), 그 로직을 호출·참조하는 "모든" 라인을 연쇄적으로 `ReplaceChunk`에 한 번에 담아서 삭제하거나 교체해야 함. 
- **재발 방지 규칙**: `[ ] 메서드나 로직의 구조체를 대체/삭제할 때는 툴 사용 전 반드시 해당 메서드가 호출되는 부분(call site)까지 전체적으로 검색 및 파악하여, 교체 청크에 누락 없이 포함한다.`

---

## 🚫 절대 하지 말 것 (Do NOT)

> 과거 실수에서 도출된 금지 행동 목록. 실수 추가 시 여기도 업데이트한다.

- [ ] 예시: `rm -rf` 명령어를 경로 확인 없이 실행하지 않는다
- [ ] 예시: 환경변수 파일(`.env`)을 git에 커밋하지 않는다
- [ ] 예시: 프로덕션 DB에 직접 쿼리를 실행하지 않는다
- [ ] 레이아웃 XML 파일 생성/수정 시 참조하는 모든 리소스(drawable, color, string)의 존재 여부를 무시하고 단독으로만 커밋(기록)하지 않는다.
- [ ] multi_replace_file_content 등 파일 조작 툴 사용 시 유지해야 할 기존 코드 라인을 누락하여 의도치 않게 삭제하지 않는다.
- [ ] 메서드 자체를 완전히 삭제/대체할 때 해당 메서드의 호출부(call site)를 빼먹고 교체 청크를 작성하지 않는다.
- [ ] 동일 레이아웃 컨테이너 내에서 뷰 교체(View Swapping)를 구현/수정할 때는 관련된 모든 형제 뷰(sibling views)가 명시적으로 GONE 처리되는지 무시하고 개발하지 않는다.
- [ ] popBackStack 이후 navigate 실패 가능성을 무시하고 복구 경로 없이 커스텀 탭 네비게이션을 배포하지 않는다.

---

## ✅ 작업 전 체크리스트

> 매 작업 시작 시 아래를 확인한다.

- [ ] 현재 작업 디렉토리가 올바른가? (`pwd`)
- [ ] 올바른 git branch에 있는가? (`git branch`)
- [ ] 필요한 환경변수가 설정되어 있는가?
- [ ] 이 파일의 "절대 하지 말 것" 목록을 확인했는가?
- [ ] 되돌리기 어려운 작업이 포함되어 있다면 사용자에게 고지했는가?
- [ ] (안드로이드/프론트 개발 시) 레이아웃/UI 파일 작성 시 참조하는 외부 리소스 파일을 올바르게 포함시켰는가?
- [ ] 파일 내용 수정 툴(multi_replace_file_content 등) 사용 시 교체 내용 중 기존 코드가 잘못 삭제되지 않았는지 확인했는가?
- [ ] 로직(구조체, 메서드 등) 대체/변경 시, 과거 로직과 연결된 호출부들이 에러를 뱉지 않도록 완벽히 수정 계획에 포함시켰는가?
- [ ] 커스텀 네비게이션에서 popBackStack 이후 navigate 실패 시 복구 목적지(startDestination 또는 안전 목적지)가 정의되어 있는가?
- [ ] 외부 SDK/Billing 콜백에서 UI 갱신이 메인 스레드로 디스패치되는가?

---

## 📊 실수 통계

| 카테고리 | 횟수 |
|----------|------|
| 파일 조작 | 2 |
| 명령어 오류 | 0 |
| 경로 실수 | 0 |
| 의존성 | 0 |
| 기타 | 3 |
| **합계** | **5** |

---

## 📝 업데이트 방법

새 실수 발생 시:
1. `## 🗂️ 실수 기록` 섹션에 새 항목 추가 (최신 순)
2. 해당 규칙을 `## 🚫 절대 하지 말 것` 목록에 추가
3. `## 📊 실수 통계` 카운트 업데이트
4. 필요 시 `## ✅ 작업 전 체크리스트` 항목 추가

---

*마지막 업데이트: 2026-02-28 | 총 기록된 실수: 5건*
