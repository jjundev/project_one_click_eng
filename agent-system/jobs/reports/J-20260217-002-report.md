# Report: J-20260217-002 - Replace DialogueSummaryFragment flow with DialogueQuizFragment

## Summary (What changed)
- Added `DialogueQuizFragment` UI flow (loading/error/quiz/completed states) and wired it to quiz generation API using summary seed JSON.
- Added `DialogueQuizViewModel` + factory with hybrid answer mode (multiple-choice when `choices` exists, text-input otherwise), max-5 defensive cap, retry handling, progression (`check -> next -> finish`), and debug logging tag `JOB_J-20260217-002`.
- Replaced learning-finish destination from `DialogueSummaryFragment` to `DialogueQuizFragment` in `DialogueLearningFragment` navigation path.
- Updated `DialogueLearningActivity` back handling to support quiz fragment stack pop behavior.
- Updated learning-finished bottom-sheet copy to quiz-oriented CTA.
- Added JVM unit tests for quiz view model progression, cap, retry recovery, and normalization-based answer checking.

## Files touched (Actual)
- `app/src/main/java/com/example/test/fragment/DialogueQuizFragment.java`
- `app/src/main/java/com/example/test/fragment/DialogueQuizViewModel.java`
- `app/src/main/java/com/example/test/fragment/DialogueQuizViewModelFactory.java`
- `app/src/main/java/com/example/test/fragment/DialogueLearningFragment.java`
- `app/src/main/java/com/example/test/activity/DialogueLearningActivity.java`
- `app/src/main/res/layout/fragment_dialogue_quiz.xml`
- `app/src/main/res/layout/item_quiz_choice.xml`
- `app/src/main/res/layout/bottom_sheet_learning_finished.xml`
- `app/src/main/res/drawable/bg_quiz_surface.xml`
- `app/src/main/res/values/strings.xml`
- `app/src/test/java/com/example/test/fragment/DialogueQuizViewModelTest.java`

## How to test (Step-by-step)
1) Run build gate command in `agent-system/repo`.
2) Launch app and enter dialogue learning flow.
3) Complete learning turns and tap finish CTA.
4) Confirm transition to Quiz screen (not Summary).
5) Verify quiz load success path, `check -> next -> finish` flow, and max 5 visible questions.
6) Verify API-failure/empty-response path shows retry UI without crash.
7) Verify back press from quiz returns to learning fragment stack.

## Build Result
- Ran:
  - `./gradlew :app:spotlessApply :app:spotlessCheck :app:assembleDebug :app:testDebugUnitTest`
- Result: PASS
- Notes:
  - Unit/integration compile gates passed locally.

## Logcat
- Tag: `JOB_J-20260217-002`
- Filter:
  - `adb logcat | grep JOB_J-20260217-002`
- Expected:
  - Quiz fragment entry and quiz loading start log.
  - Question index transition and completion/failure logs.
- Observed:
  - Not observed on device in this coding stage (build/test only).

## QA Checklist (Copy from Job + Observations)
### UX
- [ ] 시나리오 1: 학습 완료 후 Quiz 화면으로 이동하고 첫 문제가 표시된다. (코딩 단계에서 미실행)
- [ ] 시나리오 2: 정답 확인 후 다음 문제로 진행 가능하며 진행률이 업데이트된다. (코딩 단계에서 미실행)
- [ ] 시나리오 3: 문제 수는 최대 5개로 제한되고 마지막 문제 이후 완료 처리된다. (코딩 단계에서 미실행)
- [ ] 시나리오 4: API 실패/빈 응답에서도 오류 UI 또는 재시도 UI가 표시되고 크래시가 없다. (코딩 단계에서 미실행)
- [ ] 시나리오 5: 뒤로가기 동작 시 학습 화면 스택 전환이 정상 동작한다. (코딩 단계에서 미실행)

### Logcat
- [ ] 기대 로그 1: quiz 화면 진입 및 로드 시작 이벤트 로그 (코딩 단계에서 미실행)
- [ ] 기대 로그 2: 문제 인덱스 전환/완료 또는 실패 이벤트 로그 (코딩 단계에서 미실행)

## Risks / Edge cases
- If LLM returns semantically-correct but differently-worded answers, strict normalized equality may mark it incorrect.
- If summary seed is empty, quiz API can fail and user stays in retry/error path.
- Runtime UI verification on real device/emulator is pending.

## Rollback
- Revert quiz fragment/navigation changes in `DialogueLearningFragment`, `DialogueLearningActivity`, and remove new quiz UI/ViewModel resources to restore summary destination flow.
